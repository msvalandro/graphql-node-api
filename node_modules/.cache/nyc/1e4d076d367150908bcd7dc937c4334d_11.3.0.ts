"use strict";var cov_2mfgd8l5jq=function(){var path="/home/msvalandro/Documents/repo/graphql-node-api/src/graphql/resources/post/post.resolvers.ts",hash="f16991ad8f9a99b90d1ea20c4d4341f1c59ebe36",global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/msvalandro/Documents/repo/graphql-node-api/src/graphql/resources/post/post.resolvers.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:16},end:{line:3,column:47}},"2":{start:{line:4,column:30},end:{line:4,column:77}},"3":{start:{line:5,column:24},end:{line:5,column:65}},"4":{start:{line:6,column:0},end:{line:84,column:2}},"5":{start:{line:9,column:12},end:{line:11,column:44}},"6":{start:{line:14,column:12},end:{line:21,column:44}},"7":{start:{line:26,column:12},end:{line:32,column:44}},"8":{start:{line:35,column:12},end:{line:35,column:30}},"9":{start:{line:36,column:12},end:{line:44,column:44}},"10":{start:{line:41,column:16},end:{line:41,column:75}},"11":{start:{line:42,column:16},end:{line:42,column:28}},"12":{start:{line:49,column:12},end:{line:49,column:39}},"13":{start:{line:50,column:12},end:{line:54,column:44}},"14":{start:{line:51,column:16},end:{line:52,column:55}},"15":{start:{line:57,column:12},end:{line:67,column:44}},"16":{start:{line:58,column:16},end:{line:65,column:19}},"17":{start:{line:61,column:20},end:{line:61,column:79}},"18":{start:{line:62,column:20},end:{line:62,column:128}},"19":{start:{line:63,column:20},end:{line:63,column:47}},"20":{start:{line:64,column:20},end:{line:64,column:66}},"21":{start:{line:70,column:12},end:{line:70,column:30}},"22":{start:{line:71,column:12},end:{line:81,column:44}},"23":{start:{line:72,column:16},end:{line:79,column:19}},"24":{start:{line:75,column:20},end:{line:75,column:79}},"25":{start:{line:76,column:20},end:{line:76,column:130}},"26":{start:{line:77,column:20},end:{line:78,column:46}},"27":{start:{line:78,column:38},end:{line:78,column:44}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:16},end:{line:8,column:17}},loc:{start:{line:8,column:75},end:{line:12,column:9}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:18},end:{line:13,column:19}},loc:{start:{line:13,column:87},end:{line:22,column:9}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:15},end:{line:25,column:16}},loc:{start:{line:25,column:86},end:{line:33,column:9}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:14},end:{line:34,column:15}},loc:{start:{line:34,column:65},end:{line:45,column:9}},line:34},"4":{name:"(anonymous_4)",decl:{start:{line:40,column:22},end:{line:40,column:23}},loc:{start:{line:40,column:32},end:{line:43,column:13}},line:40},"5":{name:"(anonymous_5)",decl:{start:{line:48,column:84},end:{line:48,column:85}},loc:{start:{line:48,column:131},end:{line:55,column:9}},line:48},"6":{name:"(anonymous_6)",decl:{start:{line:50,column:44},end:{line:50,column:45}},loc:{start:{line:50,column:51},end:{line:53,column:13}},line:50},"7":{name:"(anonymous_7)",decl:{start:{line:56,column:84},end:{line:56,column:85}},loc:{start:{line:56,column:135},end:{line:68,column:9}},line:56},"8":{name:"(anonymous_8)",decl:{start:{line:57,column:44},end:{line:57,column:45}},loc:{start:{line:57,column:51},end:{line:66,column:13}},line:57},"9":{name:"(anonymous_9)",decl:{start:{line:60,column:26},end:{line:60,column:27}},loc:{start:{line:60,column:36},end:{line:65,column:17}},line:60},"10":{name:"(anonymous_10)",decl:{start:{line:69,column:84},end:{line:69,column:85}},loc:{start:{line:69,column:128},end:{line:82,column:9}},line:69},"11":{name:"(anonymous_11)",decl:{start:{line:71,column:44},end:{line:71,column:45}},loc:{start:{line:71,column:51},end:{line:80,column:13}},line:71},"12":{name:"(anonymous_12)",decl:{start:{line:74,column:26},end:{line:74,column:27}},loc:{start:{line:74,column:36},end:{line:79,column:17}},line:74},"13":{name:"(anonymous_13)",decl:{start:{line:78,column:30},end:{line:78,column:31}},loc:{start:{line:78,column:38},end:{line:78,column:44}},line:78}},branchMap:{"0":{loc:{start:{line:13,column:27},end:{line:13,column:37}},type:"default-arg",locations:[{start:{line:13,column:35},end:{line:13,column:37}}],line:13},"1":{loc:{start:{line:13,column:39},end:{line:13,column:49}},type:"default-arg",locations:[{start:{line:13,column:48},end:{line:13,column:49}}],line:13},"2":{loc:{start:{line:25,column:26},end:{line:25,column:36}},type:"default-arg",locations:[{start:{line:25,column:34},end:{line:25,column:36}}],line:25},"3":{loc:{start:{line:25,column:38},end:{line:25,column:48}},type:"default-arg",locations:[{start:{line:25,column:47},end:{line:25,column:48}}],line:25}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},b:{"0":[0],"1":[0],"2":[0],"3":[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_2mfgd8l5jq.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const utils_1=(cov_2mfgd8l5jq.s[1]++,require("../../../utils/utils"));const composable_resolver_1=(cov_2mfgd8l5jq.s[2]++,require("../../composable/composable.resolver"));const auth_resolver_1=(cov_2mfgd8l5jq.s[3]++,require("../../composable/auth.resolver"));cov_2mfgd8l5jq.s[4]++;exports.postResolvers={Post:{author:(post,args,{db,dataloaders:{userLoader}},info)=>{cov_2mfgd8l5jq.f[0]++;cov_2mfgd8l5jq.s[5]++;return userLoader.load({key:post.get('author'),info}).catch(utils_1.handleError);},comments:(post,{first=(cov_2mfgd8l5jq.b[0][0]++,10),offset=(cov_2mfgd8l5jq.b[1][0]++,0)},{db,requestedFields},info)=>{cov_2mfgd8l5jq.f[1]++;cov_2mfgd8l5jq.s[6]++;return db.Comment.findAll({where:{post:post.get('id')},limit:first,offset:offset,attributes:requestedFields.getFields(info)}).catch(utils_1.handleError);}},Query:{posts:(parent,{first=(cov_2mfgd8l5jq.b[2][0]++,10),offset=(cov_2mfgd8l5jq.b[3][0]++,0)},{db,requestedFields},info)=>{cov_2mfgd8l5jq.f[2]++;cov_2mfgd8l5jq.s[7]++;return db.Post.findAll({limit:first,offset:offset,attributes:requestedFields.getFields(info,{keep:['id'],exclude:['comments']})}).catch(utils_1.handleError);},post:(parent,{id},{db,requestedFields},info)=>{cov_2mfgd8l5jq.f[3]++;cov_2mfgd8l5jq.s[8]++;id=parseInt(id);cov_2mfgd8l5jq.s[9]++;return db.Post.findById(id,{attributes:requestedFields.getFields(info,{keep:['id'],exclude:['comments']})}).then(post=>{cov_2mfgd8l5jq.f[4]++;cov_2mfgd8l5jq.s[10]++;utils_1.throwError(!post,`Post with id ${id} not found.`);cov_2mfgd8l5jq.s[11]++;return post;}).catch(utils_1.handleError);}},Mutation:{createPost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{input},{db,authUser},info)=>{cov_2mfgd8l5jq.f[5]++;cov_2mfgd8l5jq.s[12]++;input.author=authUser.id;cov_2mfgd8l5jq.s[13]++;return db.sequelize.transaction(t=>{cov_2mfgd8l5jq.f[6]++;cov_2mfgd8l5jq.s[14]++;return db.Post.create(input,{transaction:t});}).catch(utils_1.handleError);}),updatePost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{id,input},{db,authUser},info)=>{cov_2mfgd8l5jq.f[7]++;cov_2mfgd8l5jq.s[15]++;return db.sequelize.transaction(t=>{cov_2mfgd8l5jq.f[8]++;cov_2mfgd8l5jq.s[16]++;return db.Post.findById(id).then(post=>{cov_2mfgd8l5jq.f[9]++;cov_2mfgd8l5jq.s[17]++;utils_1.throwError(!post,`Post with id ${id} not found.`);cov_2mfgd8l5jq.s[18]++;utils_1.throwError(post.get('author')!=authUser.id,`Unauthorized! You can only edit posts by yourself.`);cov_2mfgd8l5jq.s[19]++;input.author=authUser.id;cov_2mfgd8l5jq.s[20]++;return post.update(input,{transaction:t});});}).catch(utils_1.handleError);}),deletePost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{id},{db,authUser},info)=>{cov_2mfgd8l5jq.f[10]++;cov_2mfgd8l5jq.s[21]++;id=parseInt(id);cov_2mfgd8l5jq.s[22]++;return db.sequelize.transaction(t=>{cov_2mfgd8l5jq.f[11]++;cov_2mfgd8l5jq.s[23]++;return db.Post.findById(id).then(post=>{cov_2mfgd8l5jq.f[12]++;cov_2mfgd8l5jq.s[24]++;utils_1.throwError(!post,`Post with id ${id} not found.`);cov_2mfgd8l5jq.s[25]++;utils_1.throwError(post.get('author')!=authUser.id,`Unauthorized! You can only delete posts by yourself.`);cov_2mfgd8l5jq.s[26]++;return post.destroy({transaction:t}).then(post=>{cov_2mfgd8l5jq.f[13]++;cov_2mfgd8l5jq.s[27]++;return!!post;});});}).catch(utils_1.handleError);})}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvbXN2YWxhbmRyby9Eb2N1bWVudHMvcmVwby9ncmFwaHFsLW5vZGUtYXBpL3NyYy9ncmFwaHFsL3Jlc291cmNlcy9wb3N0L3Bvc3QucmVzb2x2ZXJzLnRzIiwic291cmNlcyI6WyIvaG9tZS9tc3ZhbGFuZHJvL0RvY3VtZW50cy9yZXBvL2dyYXBocWwtbm9kZS1hcGkvc3JjL2dyYXBocWwvcmVzb3VyY2VzL3Bvc3QvcG9zdC5yZXNvbHZlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFNQSxnREFBK0Q7QUFDL0QsOEVBQStEO0FBQy9ELGtFQUErRDtBQUtsRCxRQUFBLGFBQWEsR0FBRztJQUM1QixJQUFJLEVBQUU7UUFDTCxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFDLFVBQVUsRUFBQyxFQUErQyxFQUFFLElBQXdCLEVBQUUsRUFBRTtZQUMvSCxPQUFPLFVBQVU7aUJBQ2YsSUFBSSxDQUFDLEVBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFDLENBQUM7aUJBQ3JDLEtBQUssQ0FBQyxtQkFBVyxDQUFDLENBQUM7UUFDdEIsQ0FBQztRQUNELFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFDLEtBQUssR0FBRyxFQUFFLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFBQyxFQUFFLEVBQUMsRUFBRSxFQUFFLGVBQWUsRUFBdUQsRUFBRSxJQUF3QixFQUFFLEVBQUU7WUFDbkosT0FBTyxFQUFFLENBQUMsT0FBTztpQkFDZixPQUFPLENBQUM7Z0JBQ1IsS0FBSyxFQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUM7Z0JBQzdCLEtBQUssRUFBRSxLQUFLO2dCQUNaLE1BQU0sRUFBRSxNQUFNO2dCQUNkLFVBQVUsRUFBRSxlQUFlLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQzthQUMz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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBncmFwaHFsRmllbGRzIGZyb20gJ2dyYXBocWwtZmllbGRzJztcbmltcG9ydCB7IEdyYXBoUUxSZXNvbHZlSW5mbyB9IGZyb20gJ2dyYXBocWwnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb24gfSBmcm9tICdzZXF1ZWxpemUnO1xuXG5pbXBvcnQgeyBEYkNvbm5lY3Rpb24gfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL0RiQ29ubmVjdGlvbkludGVyZmFjZSc7XG5pbXBvcnQgeyBQb3N0SW5zdGFuY2UgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvUG9zdE1vZGVsJztcbmltcG9ydCB7IGhhbmRsZUVycm9yLCB0aHJvd0Vycm9yIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgY29tcG9zZSB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvY29tcG9zYWJsZS5yZXNvbHZlcic7XG5pbXBvcnQgeyBhdXRoUmVzb2x2ZXJzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS9hdXRoLnJlc29sdmVyJztcbmltcG9ydCB7IEF1dGhVc2VyIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9BdXRoVXNlckludGVyZmFjZSc7XG5pbXBvcnQgeyBEYXRhTG9hZGVycyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvRGF0YUxvYWRlcnNJbnRlcmZhY2UnO1xuaW1wb3J0IHsgUmVxdWVzdGVkRmllbGRzIH0gZnJvbSAnLi4vLi4vYXN0L1JlcXVlc3RlZEZpZWxkcyc7XG5cbmV4cG9ydCBjb25zdCBwb3N0UmVzb2x2ZXJzID0ge1xuXHRQb3N0OiB7XG5cdFx0YXV0aG9yOiAocG9zdCwgYXJncywge2RiLCBkYXRhbG9hZGVyczoge3VzZXJMb2FkZXJ9fToge2RiOiBEYkNvbm5lY3Rpb24sIGRhdGFsb2FkZXJzOiBEYXRhTG9hZGVyc30sIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuXHRcdFx0cmV0dXJuIHVzZXJMb2FkZXJcblx0XHRcdFx0LmxvYWQoe2tleTogcG9zdC5nZXQoJ2F1dGhvcicpLCBpbmZvfSlcblx0XHRcdFx0LmNhdGNoKGhhbmRsZUVycm9yKTtcdFx0XG5cdFx0fSxcblx0XHRjb21tZW50czogKHBvc3QsIHtmaXJzdCA9IDEwLCBvZmZzZXQgPSAwfSwge2RiLCByZXF1ZXN0ZWRGaWVsZHN9OiB7ZGI6IERiQ29ubmVjdGlvbiwgcmVxdWVzdGVkRmllbGRzOiBSZXF1ZXN0ZWRGaWVsZHN9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcblx0XHRcdHJldHVybiBkYi5Db21tZW50XG5cdFx0XHRcdC5maW5kQWxsKHtcblx0XHRcdFx0XHR3aGVyZToge3Bvc3Q6IHBvc3QuZ2V0KCdpZCcpfSxcblx0XHRcdFx0XHRsaW1pdDogZmlyc3QsXG5cdFx0XHRcdFx0b2Zmc2V0OiBvZmZzZXQsXG5cdFx0XHRcdFx0YXR0cmlidXRlczogcmVxdWVzdGVkRmllbGRzLmdldEZpZWxkcyhpbmZvKVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goaGFuZGxlRXJyb3IpO1x0XHRcdFx0XG5cdFx0fVxuXHR9LFxuXHRRdWVyeToge1xuXHRcdHBvc3RzOiAocGFyZW50LCB7Zmlyc3QgPSAxMCwgb2Zmc2V0ID0gMH0sIHtkYiwgcmVxdWVzdGVkRmllbGRzfToge2RiOiBEYkNvbm5lY3Rpb24sIHJlcXVlc3RlZEZpZWxkczogUmVxdWVzdGVkRmllbGRzfSwgaW5mbzogR3JhcGhRTFJlc29sdmVJbmZvKSA9PiB7XG5cdFx0XHRyZXR1cm4gZGIuUG9zdFxuXHRcdFx0XHQuZmluZEFsbCh7XG5cdFx0XHRcdFx0bGltaXQ6IGZpcnN0LFxuXHRcdFx0XHRcdG9mZnNldDogb2Zmc2V0LFxuXHRcdFx0XHRcdGF0dHJpYnV0ZXM6IHJlcXVlc3RlZEZpZWxkcy5nZXRGaWVsZHMoaW5mbywge2tlZXA6IFsnaWQnXSwgZXhjbHVkZTogWydjb21tZW50cyddfSlcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKGhhbmRsZUVycm9yKTtcdFx0XHRcdFxuXHRcdH0sXG5cdFx0cG9zdDogKHBhcmVudCwge2lkfSwge2RiLCByZXF1ZXN0ZWRGaWVsZHN9OiB7ZGI6IERiQ29ubmVjdGlvbiwgcmVxdWVzdGVkRmllbGRzOiBSZXF1ZXN0ZWRGaWVsZHN9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcblx0XHRcdGlkID0gcGFyc2VJbnQoaWQpO1xuXHRcdFx0cmV0dXJuIGRiLlBvc3Rcblx0XHRcdFx0LmZpbmRCeUlkKGlkLCB7XG5cdFx0XHRcdFx0YXR0cmlidXRlczogcmVxdWVzdGVkRmllbGRzLmdldEZpZWxkcyhpbmZvLCB7a2VlcDogWydpZCddLCBleGNsdWRlOiBbJ2NvbW1lbnRzJ119KVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQudGhlbigocG9zdDogUG9zdEluc3RhbmNlKSA9PiB7XG5cdFx0XHRcdFx0dGhyb3dFcnJvcighcG9zdCwgYFBvc3Qgd2l0aCBpZCAke2lkfSBub3QgZm91bmQuYCk7XG5cdFx0XHRcdFx0cmV0dXJuIHBvc3Q7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5jYXRjaChoYW5kbGVFcnJvcik7XHRcdFx0XHRcblx0XHR9XG5cdH0sXG5cdE11dGF0aW9uOiB7XG5cdFx0Y3JlYXRlUG9zdDogY29tcG9zZSguLi5hdXRoUmVzb2x2ZXJzKSgocGFyZW50LCB7aW5wdXR9LCB7ZGIsIGF1dGhVc2VyfToge2RiOiBEYkNvbm5lY3Rpb24sIGF1dGhVc2VyOiBBdXRoVXNlcn0sIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuXHRcdFx0aW5wdXQuYXV0aG9yID0gYXV0aFVzZXIuaWQ7XG5cdFx0XHRyZXR1cm4gZGIuc2VxdWVsaXplLnRyYW5zYWN0aW9uKCh0OiBUcmFuc2FjdGlvbikgPT4ge1xuXHRcdFx0XHRyZXR1cm4gZGIuUG9zdFxuXHRcdFx0XHRcdC5jcmVhdGUoaW5wdXQsIHt0cmFuc2FjdGlvbjogdH0pO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChoYW5kbGVFcnJvcik7XHRcdFx0XG5cdFx0fSksXG5cdFx0dXBkYXRlUG9zdDogY29tcG9zZSguLi5hdXRoUmVzb2x2ZXJzKSgocGFyZW50LCB7aWQsIGlucHV0fSwge2RiLCBhdXRoVXNlcn06IHtkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXJ9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcblx0XHRcdHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG5cdFx0XHRcdHJldHVybiBkYi5Qb3N0XG5cdFx0XHRcdFx0LmZpbmRCeUlkKGlkKVxuXHRcdFx0XHRcdC50aGVuKChwb3N0OiBQb3N0SW5zdGFuY2UpID0+IHtcblx0XHRcdFx0XHRcdHRocm93RXJyb3IoIXBvc3QsIGBQb3N0IHdpdGggaWQgJHtpZH0gbm90IGZvdW5kLmApO1xuXHRcdFx0XHRcdFx0dGhyb3dFcnJvcihwb3N0LmdldCgnYXV0aG9yJykgIT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBlZGl0IHBvc3RzIGJ5IHlvdXJzZWxmLmApO1x0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aW5wdXQuYXV0aG9yID0gYXV0aFVzZXIuaWQ7XHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHJldHVybiBwb3N0LnVwZGF0ZShpbnB1dCwge3RyYW5zYWN0aW9uOiB0fSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGhhbmRsZUVycm9yKTtcdFx0XHRcblx0XHR9KSxcblx0XHRkZWxldGVQb3N0OiBjb21wb3NlKC4uLmF1dGhSZXNvbHZlcnMpKChwYXJlbnQsIHtpZH0sIHtkYiwgYXV0aFVzZXJ9OiB7ZGI6IERiQ29ubmVjdGlvbiwgYXV0aFVzZXI6IEF1dGhVc2VyfSwgaW5mbzogR3JhcGhRTFJlc29sdmVJbmZvKSA9PiB7XG5cdFx0XHRpZCA9IHBhcnNlSW50KGlkKTtcblx0XHRcdHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG5cdFx0XHRcdHJldHVybiBkYi5Qb3N0XG5cdFx0XHRcdFx0LmZpbmRCeUlkKGlkKVxuXHRcdFx0XHRcdC50aGVuKChwb3N0OiBQb3N0SW5zdGFuY2UpID0+IHtcblx0XHRcdFx0XHRcdHRocm93RXJyb3IoIXBvc3QsIGBQb3N0IHdpdGggaWQgJHtpZH0gbm90IGZvdW5kLmApO1xuXHRcdFx0XHRcdFx0dGhyb3dFcnJvcihwb3N0LmdldCgnYXV0aG9yJykgIT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBkZWxldGUgcG9zdHMgYnkgeW91cnNlbGYuYCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcG9zdC5kZXN0cm95KHt0cmFuc2FjdGlvbjogdH0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKHBvc3QgPT4gISFwb3N0KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goaGFuZGxlRXJyb3IpO1x0XHRcdFxuXHRcdH0pXG5cdH1cbn07Il19