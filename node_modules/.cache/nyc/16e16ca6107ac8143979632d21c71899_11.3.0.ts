"use strict";var cov_mfdkhwgld=function(){var path="/home/msvalandro/Documents/repo/graphql-node-api/src/graphql/resources/comment/comment.resolvers.ts",hash="7a31e7f150434ed0db1b5f8ff4941c9e6bb41cf0",global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/msvalandro/Documents/repo/graphql-node-api/src/graphql/resources/comment/comment.resolvers.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:16},end:{line:3,column:47}},"2":{start:{line:4,column:30},end:{line:4,column:77}},"3":{start:{line:5,column:24},end:{line:5,column:65}},"4":{start:{line:6,column:0},end:{line:70,column:2}},"5":{start:{line:9,column:12},end:{line:11,column:44}},"6":{start:{line:14,column:12},end:{line:16,column:44}},"7":{start:{line:21,column:12},end:{line:21,column:38}},"8":{start:{line:22,column:12},end:{line:29,column:44}},"9":{start:{line:34,column:12},end:{line:34,column:37}},"10":{start:{line:35,column:12},end:{line:39,column:44}},"11":{start:{line:36,column:16},end:{line:37,column:55}},"12":{start:{line:42,column:12},end:{line:42,column:30}},"13":{start:{line:43,column:12},end:{line:53,column:44}},"14":{start:{line:44,column:16},end:{line:51,column:19}},"15":{start:{line:47,column:20},end:{line:47,column:85}},"16":{start:{line:48,column:20},end:{line:48,column:132}},"17":{start:{line:49,column:20},end:{line:49,column:45}},"18":{start:{line:50,column:20},end:{line:50,column:69}},"19":{start:{line:56,column:12},end:{line:56,column:30}},"20":{start:{line:57,column:12},end:{line:67,column:44}},"21":{start:{line:58,column:16},end:{line:65,column:19}},"22":{start:{line:61,column:20},end:{line:61,column:85}},"23":{start:{line:62,column:20},end:{line:62,column:134}},"24":{start:{line:63,column:20},end:{line:64,column:52}},"25":{start:{line:64,column:41},end:{line:64,column:50}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:14},end:{line:8,column:15}},loc:{start:{line:8,column:76},end:{line:12,column:9}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:14},end:{line:13,column:15}},loc:{start:{line:13,column:76},end:{line:17,column:9}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:20,column:56},end:{line:20,column:57}},loc:{start:{line:20,column:135},end:{line:30,column:9}},line:20},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:87},end:{line:33,column:88}},loc:{start:{line:33,column:134},end:{line:40,column:9}},line:33},"4":{name:"(anonymous_4)",decl:{start:{line:35,column:44},end:{line:35,column:45}},loc:{start:{line:35,column:51},end:{line:38,column:13}},line:35},"5":{name:"(anonymous_5)",decl:{start:{line:41,column:87},end:{line:41,column:88}},loc:{start:{line:41,column:138},end:{line:54,column:9}},line:41},"6":{name:"(anonymous_6)",decl:{start:{line:43,column:44},end:{line:43,column:45}},loc:{start:{line:43,column:51},end:{line:52,column:13}},line:43},"7":{name:"(anonymous_7)",decl:{start:{line:46,column:26},end:{line:46,column:27}},loc:{start:{line:46,column:39},end:{line:51,column:17}},line:46},"8":{name:"(anonymous_8)",decl:{start:{line:55,column:87},end:{line:55,column:88}},loc:{start:{line:55,column:131},end:{line:68,column:9}},line:55},"9":{name:"(anonymous_9)",decl:{start:{line:57,column:44},end:{line:57,column:45}},loc:{start:{line:57,column:51},end:{line:66,column:13}},line:57},"10":{name:"(anonymous_10)",decl:{start:{line:60,column:26},end:{line:60,column:27}},loc:{start:{line:60,column:39},end:{line:65,column:17}},line:60},"11":{name:"(anonymous_11)",decl:{start:{line:64,column:30},end:{line:64,column:31}},loc:{start:{line:64,column:41},end:{line:64,column:50}},line:64}},branchMap:{"0":{loc:{start:{line:20,column:75},end:{line:20,column:85}},type:"default-arg",locations:[{start:{line:20,column:83},end:{line:20,column:85}}],line:20},"1":{loc:{start:{line:20,column:87},end:{line:20,column:97}},type:"default-arg",locations:[{start:{line:20,column:96},end:{line:20,column:97}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0],"1":[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_mfdkhwgld.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const utils_1=(cov_mfdkhwgld.s[1]++,require("../../../utils/utils"));const composable_resolver_1=(cov_mfdkhwgld.s[2]++,require("../../composable/composable.resolver"));const auth_resolver_1=(cov_mfdkhwgld.s[3]++,require("../../composable/auth.resolver"));cov_mfdkhwgld.s[4]++;exports.commentResolvers={Comment:{user:(comment,args,{db,dataloaders:{userLoader}},info)=>{cov_mfdkhwgld.f[0]++;cov_mfdkhwgld.s[5]++;return userLoader.load({key:comment.get('user'),info}).catch(utils_1.handleError);},post:(comment,args,{db,dataloaders:{postLoader}},info)=>{cov_mfdkhwgld.f[1]++;cov_mfdkhwgld.s[6]++;return postLoader.load({key:comment.get('post'),info}).catch(utils_1.handleError);}},Query:{commentsByPost:composable_resolver_1.compose()((parent,{postId,first=(cov_mfdkhwgld.b[0][0]++,10),offset=(cov_mfdkhwgld.b[1][0]++,0)},{db,requestedFields},info)=>{cov_mfdkhwgld.f[2]++;cov_mfdkhwgld.s[7]++;postId=parseInt(postId);cov_mfdkhwgld.s[8]++;return db.Comment.findAll({where:{post:postId},limit:first,offset:offset,attributes:requestedFields.getFields(info,{keep:undefined})}).catch(utils_1.handleError);})},Mutation:{createComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{input},{db,authUser},info)=>{cov_mfdkhwgld.f[3]++;cov_mfdkhwgld.s[9]++;input.user=authUser.id;cov_mfdkhwgld.s[10]++;return db.sequelize.transaction(t=>{cov_mfdkhwgld.f[4]++;cov_mfdkhwgld.s[11]++;return db.Comment.create(input,{transaction:t});}).catch(utils_1.handleError);}),updateComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{id,input},{db,authUser},info)=>{cov_mfdkhwgld.f[5]++;cov_mfdkhwgld.s[12]++;id=parseInt(id);cov_mfdkhwgld.s[13]++;return db.sequelize.transaction(t=>{cov_mfdkhwgld.f[6]++;cov_mfdkhwgld.s[14]++;return db.Comment.findById(id).then(comment=>{cov_mfdkhwgld.f[7]++;cov_mfdkhwgld.s[15]++;utils_1.throwError(!comment,`Comment with id ${id} not found.`);cov_mfdkhwgld.s[16]++;utils_1.throwError(comment.get('user')!=authUser.id,`Unauthorized! You can only edit comments by yourself.`);cov_mfdkhwgld.s[17]++;input.user=authUser.id;cov_mfdkhwgld.s[18]++;return comment.update(input,{transaction:t});});}).catch(utils_1.handleError);}),deleteComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((parent,{id},{db,authUser},info)=>{cov_mfdkhwgld.f[8]++;cov_mfdkhwgld.s[19]++;id=parseInt(id);cov_mfdkhwgld.s[20]++;return db.sequelize.transaction(t=>{cov_mfdkhwgld.f[9]++;cov_mfdkhwgld.s[21]++;return db.Comment.findById(id).then(comment=>{cov_mfdkhwgld.f[10]++;cov_mfdkhwgld.s[22]++;utils_1.throwError(!comment,`Comment with id ${id} not found.`);cov_mfdkhwgld.s[23]++;utils_1.throwError(comment.get('user')!=authUser.id,`Unauthorized! You can only delete comments by yourself.`);cov_mfdkhwgld.s[24]++;return comment.destroy({transaction:t}).then(comment=>{cov_mfdkhwgld.f[11]++;cov_mfdkhwgld.s[25]++;return!!comment;});});}).catch(utils_1.handleError);})}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvbXN2YWxhbmRyby9Eb2N1bWVudHMvcmVwby9ncmFwaHFsLW5vZGUtYXBpL3NyYy9ncmFwaHFsL3Jlc291cmNlcy9jb21tZW50L2NvbW1lbnQucmVzb2x2ZXJzLnRzIiwic291cmNlcyI6WyIvaG9tZS9tc3ZhbGFuZHJvL0RvY3VtZW50cy9yZXBvL2dyYXBocWwtbm9kZS1hcGkvc3JjL2dyYXBocWwvcmVzb3VyY2VzL2NvbW1lbnQvY29tbWVudC5yZXNvbHZlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFLQSxnREFBK0Q7QUFDL0QsOEVBQStEO0FBQy9ELGtFQUErRDtBQUtsRCxRQUFBLGdCQUFnQixHQUFHO0lBQy9CLE9BQU8sRUFBRTtRQUNSLElBQUksRUFBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBQyxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUMsVUFBVSxFQUFDLEVBQStDLEVBQUUsSUFBd0IsRUFBRSxFQUFFO1lBQ2pJLE9BQU8sVUFBVTtpQkFDZixJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUMsQ0FBQztpQkFDdEMsS0FBSyxDQUFDLG1CQUFXLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBQ0QsSUFBSSxFQUFHLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFDLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBQyxVQUFVLEVBQUMsRUFBK0MsRUFBRSxJQUF3QixFQUFFLEVBQUU7WUFDakksT0FBTyxVQUFVO2lCQUNmLElBQUksQ0FBQyxFQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBQyxDQUFDO2lCQUN0QyxLQUFLLENBQUMsbUJBQVcsQ0FBQyxDQUFDO1FBQ3RCLENBQUM7S0FDRDtJQUNELEtBQUssRUFBRTtRQUNOLGNBQWMsRUFBRSw2QkFBTyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUs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SSxDQUFDLENBQUMsT0FBd0IsRUFBRSxFQUFFO29CQUNsQyxrQkFBVSxDQUFDLENBQUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGFBQWEsQ0FBQyxDQUFDO29CQUN6RCxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksUUFBUSxDQUFDLEVBQUUsRUFBRSx5REFBeUQsQ0FBQyxDQUFDO29CQUMxRyxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxXQUFXLEVBQUUsQ0FBQyxFQUFDLENBQUM7eUJBQ3RDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDOUIsQ0FBQyxDQUFDLENBQUE7WUFDSixDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLG1CQUFXLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUM7S0FDRjtDQUNELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmFwaFFMUmVzb2x2ZUluZm8gfSBmcm9tICdncmFwaHFsJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uIH0gZnJvbSAnc2VxdWVsaXplJztcblxuaW1wb3J0IHsgRGJDb25uZWN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9EYkNvbm5lY3Rpb25JbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ29tbWVudEluc3RhbmNlIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL0NvbW1lbnRNb2RlbCc7XG5pbXBvcnQgeyBoYW5kbGVFcnJvciwgdGhyb3dFcnJvciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IGNvbXBvc2UgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL2NvbXBvc2FibGUucmVzb2x2ZXInO1xuaW1wb3J0IHsgYXV0aFJlc29sdmVycyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvYXV0aC5yZXNvbHZlcic7XG5pbXBvcnQgeyBBdXRoVXNlciB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvQXV0aFVzZXJJbnRlcmZhY2UnO1xuaW1wb3J0IHsgRGF0YUxvYWRlcnMgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL0RhdGFMb2FkZXJzSW50ZXJmYWNlJztcbmltcG9ydCB7IFJlcXVlc3RlZEZpZWxkcyB9IGZyb20gJy4uLy4uL2FzdC9SZXF1ZXN0ZWRGaWVsZHMnO1xuXG5leHBvcnQgY29uc3QgY29tbWVudFJlc29sdmVycyA9IHtcblx0Q29tbWVudDoge1xuXHRcdHVzZXI6ICAoY29tbWVudCwgYXJncywge2RiLCBkYXRhbG9hZGVyczoge3VzZXJMb2FkZXJ9fToge2RiOiBEYkNvbm5lY3Rpb24sIGRhdGFsb2FkZXJzOiBEYXRhTG9hZGVyc30sIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuXHRcdFx0cmV0dXJuIHVzZXJMb2FkZXJcblx0XHRcdFx0LmxvYWQoe2tleTogY29tbWVudC5nZXQoJ3VzZXInKSwgaW5mb30pXG5cdFx0XHRcdC5jYXRjaChoYW5kbGVFcnJvcik7XG5cdFx0fSxcblx0XHRwb3N0OiAgKGNvbW1lbnQsIGFyZ3MsIHtkYiwgZGF0YWxvYWRlcnM6IHtwb3N0TG9hZGVyfX06IHtkYjogRGJDb25uZWN0aW9uLCBkYXRhbG9hZGVyczogRGF0YUxvYWRlcnN9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcblx0XHRcdHJldHVybiBwb3N0TG9hZGVyXG5cdFx0XHRcdC5sb2FkKHtrZXk6IGNvbW1lbnQuZ2V0KCdwb3N0JyksIGluZm99KVxuXHRcdFx0XHQuY2F0Y2goaGFuZGxlRXJyb3IpO1x0XHRcdFx0XG5cdFx0fVxuXHR9LFxuXHRRdWVyeToge1xuXHRcdGNvbW1lbnRzQnlQb3N0OiBjb21wb3NlKCkoKHBhcmVudCwge3Bvc3RJZCwgZmlyc3QgPSAxMCwgb2Zmc2V0ID0gMH0sIHtkYiwgcmVxdWVzdGVkRmllbGRzfToge2RiOiBEYkNvbm5lY3Rpb24sIHJlcXVlc3RlZEZpZWxkczogUmVxdWVzdGVkRmllbGRzfSwgaW5mbzogR3JhcGhRTFJlc29sdmVJbmZvKSA9PiB7XG5cdFx0XHRwb3N0SWQgPSBwYXJzZUludChwb3N0SWQpO1x0XHRcdFxuXHRcdFx0cmV0dXJuIGRiLkNvbW1lbnRcblx0XHRcdFx0LmZpbmRBbGwoe1xuXHRcdFx0XHRcdHdoZXJlOiB7cG9zdDogcG9zdElkfSxcblx0XHRcdFx0XHRsaW1pdDogZmlyc3QsXG5cdFx0XHRcdFx0b2Zmc2V0OiBvZmZzZXQsXG5cdFx0XHRcdFx0YXR0cmlidXRlczogcmVxdWVzdGVkRmllbGRzLmdldEZpZWxkcyhpbmZvLCB7a2VlcDogdW5kZWZpbmVkfSlcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKGhhbmRsZUVycm9yKTtcdFx0XHRcdFxuXHRcdH0pXG5cdH0sXG5cdE11dGF0aW9uOiB7XG5cdFx0Y3JlYXRlQ29tbWVudDogY29tcG9zZSguLi5hdXRoUmVzb2x2ZXJzKSgocGFyZW50LCB7aW5wdXR9LCB7ZGIsIGF1dGhVc2VyfToge2RiOiBEYkNvbm5lY3Rpb24sIGF1dGhVc2VyOiBBdXRoVXNlcn0sIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuXHRcdFx0aW5wdXQudXNlciA9IGF1dGhVc2VyLmlkO1xuXHRcdFx0cmV0dXJuIGRiLnNlcXVlbGl6ZS50cmFuc2FjdGlvbigodDogVHJhbnNhY3Rpb24pID0+IHtcblx0XHRcdFx0cmV0dXJuIGRiLkNvbW1lbnRcblx0XHRcdFx0XHQuY3JlYXRlKGlucHV0LCB7dHJhbnNhY3Rpb246IHR9KTtcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goaGFuZGxlRXJyb3IpO1x0XHRcdFxuXHRcdH0pLFxuXHRcdHVwZGF0ZUNvbW1lbnQ6IGNvbXBvc2UoLi4uYXV0aFJlc29sdmVycykoKHBhcmVudCwge2lkLCBpbnB1dH0sIHtkYiwgYXV0aFVzZXJ9OiB7ZGI6IERiQ29ubmVjdGlvbiwgYXV0aFVzZXI6IEF1dGhVc2VyfSwgaW5mbzogR3JhcGhRTFJlc29sdmVJbmZvKSA9PiB7XG5cdFx0XHRpZCA9IHBhcnNlSW50KGlkKTtcblx0XHRcdHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG5cdFx0XHRcdHJldHVybiBkYi5Db21tZW50XG5cdFx0XHRcdFx0LmZpbmRCeUlkKGlkKVxuXHRcdFx0XHRcdC50aGVuKChjb21tZW50OiBDb21tZW50SW5zdGFuY2UpID0+IHtcblx0XHRcdFx0XHRcdHRocm93RXJyb3IoIWNvbW1lbnQsIGBDb21tZW50IHdpdGggaWQgJHtpZH0gbm90IGZvdW5kLmApO1xuXHRcdFx0XHRcdFx0dGhyb3dFcnJvcihjb21tZW50LmdldCgndXNlcicpICE9IGF1dGhVc2VyLmlkLCBgVW5hdXRob3JpemVkISBZb3UgY2FuIG9ubHkgZWRpdCBjb21tZW50cyBieSB5b3Vyc2VsZi5gKTtcblx0XHRcdFx0XHRcdGlucHV0LnVzZXIgPSBhdXRoVXNlci5pZDtcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHJldHVybiBjb21tZW50LnVwZGF0ZShpbnB1dCwge3RyYW5zYWN0aW9uOiB0fSk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goaGFuZGxlRXJyb3IpO1x0XHRcdFxuXHRcdH0pLFxuXHRcdGRlbGV0ZUNvbW1lbnQ6IGNvbXBvc2UoLi4uYXV0aFJlc29sdmVycykoKHBhcmVudCwge2lkfSwge2RiLCBhdXRoVXNlcn06IHtkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXJ9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcblx0XHRcdGlkID0gcGFyc2VJbnQoaWQpO1xuXHRcdFx0cmV0dXJuIGRiLnNlcXVlbGl6ZS50cmFuc2FjdGlvbigodDogVHJhbnNhY3Rpb24pID0+IHtcblx0XHRcdFx0cmV0dXJuIGRiLkNvbW1lbnRcblx0XHRcdFx0XHQuZmluZEJ5SWQoaWQpXG5cdFx0XHRcdFx0LnRoZW4oKGNvbW1lbnQ6IENvbW1lbnRJbnN0YW5jZSkgPT4ge1xuXHRcdFx0XHRcdFx0dGhyb3dFcnJvcighY29tbWVudCwgYENvbW1lbnQgd2l0aCBpZCAke2lkfSBub3QgZm91bmQuYCk7XG5cdFx0XHRcdFx0XHR0aHJvd0Vycm9yKGNvbW1lbnQuZ2V0KCd1c2VyJykgIT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBkZWxldGUgY29tbWVudHMgYnkgeW91cnNlbGYuYCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY29tbWVudC5kZXN0cm95KHt0cmFuc2FjdGlvbjogdH0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKGNvbW1lbnQgPT4gISFjb21tZW50KTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChoYW5kbGVFcnJvcik7XHRcdFx0XG5cdFx0fSlcblx0fVxufTsiXX0=